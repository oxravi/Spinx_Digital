(self.AMP=self.AMP||[]).push({m:0,v:"2110082201002",n:"amp-user-notification",ev:"0.1",l:true,f:function(AMP,_){"use strict";var h;function k(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}var l="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function m(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var e=b[c];if(e&&e.Math==Math)return}(function(){throw Error("Cannot find global object")})()}m(this);"function"===typeof Symbol&&Symbol("x");var n;if("function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var p;a:{var q={a:!0},r={};try{r.__proto__=q;p=r.a;break a}catch(a){}p=!1}n=p?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var u,t=n;function v(){return u?u:u=Promise.resolve(void 0)}function w(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}var aa=Array.isArray;function ba(a){var b=null,c="";var e=arguments;var d="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];e=d?d.call(e):{next:k(e)};for(d=e.next();!d.done;d=e.next())if(d=d.value,d instanceof Error&&!b){var g=b=void 0;if(null==(g=Object.getOwnPropertyDescriptor(d,"message"))?0:g.writable)b=d;else{g=d.stack;var f=Error(d.message);for(b in d)f[b]=d[b];f.stack=g;b=f}}else c&&(c+=" "),c+=d;b?c&&(b.message=c+": "+b.message):b=Error(c);return b}function ca(a){var b=ba.apply(null,arguments);setTimeout((function(){var c,e;null==(e=(c=self).__AMP_REPORT_ERROR)||e.call(c,b);throw b}))}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var x=self.AMP_CONFIG||{},da=("string"==typeof x.cdnProxyRegex?new RegExp(x.cdnProxyRegex):x.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function y(a){if(self.document&&self.document.head&&(!self.location||!da.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}x.cdnUrl||y("runtime-host");x.geoApiUrl||y("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var z=self.__AMP_LOG;function A(){throw Error("failed to call initLogConstructor")}function B(){z.user||(z.user=A());return z.user}function C(a,b,c,e,d){return B().assert(a,b,c,e,d,void 0,void 0,void 0,void 0,void 0,void 0)}function D(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return E(a,b)}function ea(a){a=F(a);a=G(a);return H(a,"url-replace")?E(a,"url-replace"):null}function F(a){return a.nodeType?D((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function G(a){a=F(a);return a.isSingleDoc()?a.win:a}function E(a,b){H(a,b);a=K(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function L(a,b){var c=M(a,b);if(c)return c;a=K(a);a[b]=fa();return a[b].promise}function M(a,b){var c=K(a)[b];if(c){if(c.promise)return c.promise;E(a,b);return c.promise=Promise.resolve(c.obj)}return null}function K(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function H(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}function fa(){var a=new w,b=a.promise,c=a.reject;a=a.resolve;b.catch((function(){}));return{obj:null,promise:b,resolve:a,reject:c,context:null,ctor:null}}function ha(a){var b=M(G(a),"geo");if(b)return b;var c=F(a);return c.whenExtensionsKnown().then((function(){var e=c.getExtensionVersion("amp-geo");return e?D(c.win,"extensions").waitForExtension("amp-geo",e):null})).then((function(e){return e?M(G(a),"geo"):null}))}function N(){this.h=0;this.U=v();this.S=function(){};this.T=function(){}}N.prototype.onQueueEmpty=function(a){this.S=a;0==this.h&&a()};N.prototype.onQueueNotEmpty=function(a){this.T=a;0<this.h&&a()};N.prototype.registerUI=function(a){var b=this;0==this.h&&this.T();this.h++;var c=this.U.then((function(){return a().then((function(){b.h--;0==b.h&&b.S()}))}));return this.U=c};function O(){this.X=100;this.G=this.J=0;this.B=Object.create(null)}O.prototype.has=function(a){return!!this.B[a]};O.prototype.get=function(a){var b=this.B[a];if(b)return b.access=++this.G,b.payload};O.prototype.put=function(a,b){this.has(a)||this.J++;this.B[a]={payload:b,access:this.G};if(!(this.J<=this.X)){a=this.B;var e,c=this.G+1;for(e in a){var d=a[e].access;if(d<c){c=d;var g=e}}void 0!==g&&(delete a[g],this.J--)}};new Set(["c","v","a","ad"]);var P,Q;function R(a,b){var c=void 0===c?"source":c;C(null!=a,"%s %s must be available",b,c);var e=a;if("string"==typeof e){P||(P=self.document.createElement("a"),Q=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new O));var d=P,g=Q;if(g&&g.has(e))e=g.get(e);else{d.href=e;d.protocol||(d.href=d.href);var f={href:d.href,protocol:d.protocol,host:d.host,hostname:d.hostname,port:"0"==d.port?"":d.port,pathname:d.pathname,search:d.search,hash:d.hash,origin:null};"/"!==f.pathname[0]&&(f.pathname="/"+f.pathname);if("http:"==f.protocol&&80==f.port||"https:"==f.protocol&&443==f.port)f.port="",f.host=f.hostname;f.origin=d.origin&&"null"!=d.origin?d.origin:"data:"!=f.protocol&&f.host?f.protocol+"//"+f.host:f.href;g&&g.put(e,f);e=f}}(d="https:"==e.protocol||"localhost"==e.hostname||"127.0.0.1"==e.hostname)||(e=e.hostname,d=e.length-10,d=0<=d&&e.indexOf(".localhost",d)==d);C(d||/^\/\//.test(a),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,c,a)}function S(a){a=AMP.BaseElement.call(this,a)||this;a.M=null;a.A=null;var b=new w;a.N=b.promise;a.O=b.resolve;a.o=null;a.I=!1;a.D=null;a.F=null;a.C=null;a.j=null;a.K="";a.L=null;a.W=null;return a}var T=AMP.BaseElement;S.prototype=l(T.prototype);S.prototype.constructor=S;if(t)t(S,T);else for(var V in T)if("prototype"!=V)if(Object.defineProperties){var W=Object.getOwnPropertyDescriptor(T,V);W&&Object.defineProperty(S,V,W)}else S[V]=T[V];S.aa=T.prototype;h=S.prototype;h.isAlwaysFixed=function(){return!0};h.buildCallback=function(){var a=this,b=this.getAmpDoc();this.W=ea(this.element);this.L=L(G(this.element),"storage");this.A=C(this.element.id,"amp-user-notification should have an id.");this.K="amp-user-notification:"+this.A;this.D=this.element.getAttribute("data-show-if-geo");this.F=this.element.getAttribute("data-show-if-not-geo");(this.j=this.element.getAttribute("data-show-if-href"))&&R(this.j,this.element);C(1>=!!this.j+!!this.D+!!this.F,'Only one "data-show-if-*" attribute allowed');this.D&&(this.C=X(this,this.D,!0));this.F&&(this.C=X(this,this.F,!1));(this.o=this.element.getAttribute("data-dismiss-href"))&&R(this.o,this.element);this.element.getAttribute("role")||this.element.setAttribute("role","alert");var c=this.element.getAttribute("data-persist-dismissal");this.I="false"!=c&&"no"!=c;this.registerDefaultAction((function(){return a.dismiss(!1)}),"dismiss");this.registerAction("optoutOfCid",(function(){return ia(a)}));L(G(b),"userNotificationManager").then((function(e){e.registerUserNotification(a.A,a)}))};function X(a,b,c){return ha(a.element).then((function(e){C(e,"requires <amp-geo> to use promptIfUnknownForGeoGroup");var d=b.split(/,\s*/).filter((function(g){return 2==e.isInCountryGroup(g)}));return!(c?!d.length:d.length)}))}function ja(a,b){return a.W.expandUrlAsync(a.j).then((function(c){var e={elementId:a.A,ampUserId:b};var d=[];for(var g in e){var f=e[g];if(null!=f){f=aa(f)?f:[f];for(var I=0;I<f.length;I++){var U=d,ka=U.push;var J=f[I];J=encodeURIComponent(g)+"="+encodeURIComponent(J);ka.call(U,J)}}}d=d.join("&");d?(e=c.split("#",2),g=e[0].split("?",2),d=g[0]+(g[1]?"?"+g[1]+"&"+d:"?"+d),e=d+=e[1]?"#"+e[1]:""):e=c;return e}))}h.Y=function(a){var b=this;this.M=a;return ja(this,a).then((function(c){return D(b.win,"xhr").fetchJson(c,{credentials:"include"}).then((function(e){return e.json()}))}))};function la(a){var b=a.element.getAttribute("enctype")||"application/json;charset=utf-8",c=D(a.win,"xhr");c.fetchJson.call(c,a.o,{method:"POST",credentials:"include",body:{elementId:a.A,ampUserId:a.M},headers:{"Content-Type":b}})}h.$=function(a){C("boolean"==typeof a.showNotification,'`showNotification` should be a boolean. Got "%s" which is of type %s.',a.showNotification,typeof a.showNotification);a.showNotification||this.O();return Promise.resolve(a.showNotification)};function ia(a){return L(G(a.element),"cid").then((function(b){return b.optOut()})).then((function(){return a.dismiss(!1)}),(function(b){(z.dev||(z.dev=A())).error("amp-user-notification","Failed to opt out of Cid",b);a.dismiss(!0)}))}function ma(a){return L(G(a.element),"cid").then((function(b){return b.get({scope:"amp-user-notification",createCookieIfNotPresent:!0},v(),a.N)}))}h.shouldShow=function(){var a=this;return this.isDismissed().then((function(b){return b?!1:a.j?ma(a).then(a.Y.bind(a)).then(a.$.bind(a)):a.C?a.C:!0}))};h.show=function(){var a=this.element,b=!0;void 0===b&&(b=a.hasAttribute("hidden"));b?a.removeAttribute("hidden"):a.setAttribute("hidden","");this.element.classList.add("amp-active");this.getViewport().addToFixedLayer(this.element);return this.N};h.isDismissed=function(){var a=this;return this.I?this.L.then((function(b){return b.get(a.K)})).then((function(b){return!!b}),(function(b){(z.dev||(z.dev=A())).error("amp-user-notification","Failed to read storage",b);return!1})):Promise.resolve(!1)};h.dismiss=function(a){var b=this;this.element.classList.remove("amp-active");this.element.classList.add("amp-hidden");this.O();this.getViewport().removeFromFixedLayer(this.element);this.I&&!a&&this.L.then((function(c){c.set(b.K,!0)}));this.o&&la(this)};function Y(a){this.ampdoc=a;this.V=Object.create(null);this.H=Object.create(null);this.P=this.ampdoc.whenReady();this.R=Promise.all([this.ampdoc.whenFirstVisible(),this.P]);this.Z=L(G(this.ampdoc),"notificationUIManager")}Y.prototype.get=function(a){var b=this;this.R.then((function(){null==b.ampdoc.getElementById(a)&&B().warn("amp-user-notification","Did not find amp-user-notification element "+a+".")}));return Z(this,a).promise};Y.prototype.getNotification=function(a){var b=this;return this.P.then((function(){return b.V[a]}))};Y.prototype.registerUserNotification=function(a,b){var c=this;this.V[a]=b;var e=Z(this,a);return this.R.then((function(){return b.shouldShow()})).then((function(d){if(d)return c.Z.then((function(g){return g.registerUI(b.show.bind(b))}))})).then(e.resolve.bind(this,b)).catch(ca.bind(null,"Notification service failed amp-user-notification",a))};function Z(a,b){if(a.H[b])return a.H[b];var c=new w;return a.H[b]={promise:c.promise,resolve:c.resolve}}AMP.registerServiceForDoc("userNotificationManager",Y);AMP.registerServiceForDoc("notificationUIManager",N);AMP.registerElement("amp-user-notification",S,"amp-user-notification{position:fixed!important;bottom:0;left:0;overflow:hidden!important;visibility:hidden;background:hsla(0,0%,100%,0.7);z-index:1000;width:100%}amp-user-notification.amp-active{visibility:visible}amp-user-notification.amp-hidden{visibility:hidden}\n/*# sourceURL=/extensions/amp-user-notification/0.1/amp-user-notification.css*/")}});//# sourceMappingURL=amp-user-notification-0.1.js.map